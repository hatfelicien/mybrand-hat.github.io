<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="./css/dash.css" />
  </head>
  <body>
    <header>
      <h1>Admin Dashboard</h1>
    </header>

    <nav>
      <a href="dashboard.html">Dashboard</a>
      <a href="comments.html">Comment</a>
      <a href="message.html">Messages</a>
      <a href="article.html">Article</a>
      <a href="add.html">Add Article</a>
      <a href="subscribers.html">Subscribers</a>
      <a href="login.html">Logout</a>
    </nav>

    <div class="content">
      <div class="card">
        <h1>Articles on your blog</h1>
        <div id="displayData"></div>

        <div id="overlay"></div>
        <div id="updateForm">
          <h2>Update Post</h2>
          <label for="updateTitle">Title:</label>
          <input type="text" id="updateTitle" />

          <label for="updateTags">Tags:</label>
          <input type="text" id="updateTags" />

          <label for="updateContent">Content:</label>
          <textarea id="updateContent"></textarea>

          <button onclick="updatePost()">Update</button>
          <button onclick="closeUpdateForm()">Cancel</button>
        </div>
      </div>
      <div id="overlay2" class="overlay2">
        <!-- Popup Content -->
        <div class="popup">
          <p>do you want to delete this Article</p>
          <center>
            <button class="del" onclick="deletePost()">Yes</button>
            <button class="up" onclick="hideConfirmation()">No</button>
          </center>
        </div>
      </div>
    </div>
    <footer>&copy; 2024 Admin Dashboard</footer>
  </body>
  <script>
    function retrieveDataFromLocalStorage() {
      const storedData = JSON.parse(localStorage.getItem("postData")) || [];
      const displayDataDiv = document.getElementById("displayData");

      // Clear existing data before appending
      displayDataDiv.innerHTML = "";

      if (storedData.length > 0) {
        for (let i = 0; i < storedData.length; i++) {
          const postData = storedData[i];

          // Create HTML elements to display the data
          const postDiv = document.createElement("div");
          postDiv.innerHTML = `
                <h3>Title: ${postData.title}</h3>
                <p>Tags: ${postData.tag}</p>
                <div id="imageContainer_${i}"></div>
                <p>Content: ${postData.content}</p>
                <p>References: ${postData.references}</p>
                <button class="del" onclick="showConfirmation(${i})">Delete</button>
                <button class="up" onclick="openUpdateForm(${i})">Update</button>
                <hr>
            `;

          // Append the postDiv to the displayDataDiv
          displayDataDiv.appendChild(postDiv);

          // Display the stored image
          displayStoredImage(postData.img, `imageContainer_${i}`);
        }
      } else {
        displayDataDiv.innerHTML = "<p>No data stored in local storage.</p>";
      }
    }

    // Function to display the stored image
    function displayStoredImage(imageData, containerId) {
      // Check if there is stored image data
      if (imageData) {
        // Create an image element and set its source to the stored data
        const image = document.createElement("img");
        image.src = imageData;

        // Append the image to the specified container
        const imageContainer = document.getElementById(containerId);
        imageContainer.appendChild(image);
      }
    }

    // Call the function to retrieve and display data on page load
    window.onload = retrieveDataFromLocalStorage;

    // Function to show the confirmation popup
    function showConfirmation(index) {
      // Pass the correct index to the deletePost function
      document.getElementById("overlay2").style.display = "flex";
      document
        .getElementById("confirmDelete")
        .setAttribute("onclick", `deletePost(${index})`);
    }

    // Function to hide the confirmation popup
    function hideConfirmation() {
      document.getElementById("overlay2").style.display = "none";
    }

    function deletePost(index) {
      const storedData = JSON.parse(localStorage.getItem("postData")) || [];

      if (storedData.length > 0) {
        // Remove the post at the specified index
        storedData.splice(index, 1);

        // Save the updated data back to local storage
        localStorage.setItem("postData", JSON.stringify(storedData));

        // Refresh the display
        hideConfirmation();
        retrieveDataFromLocalStorage(); // Call this function instead of location.reload()
      }
    }

    function openUpdateForm(index) {
      const storedData = JSON.parse(localStorage.getItem("postData")) || [];
      const updateForm = document.getElementById("updateForm");
      const overlay = document.getElementById("overlay");

      // Populate the update form with the data of the selected post
      document.getElementById("updateTitle").value = storedData[index].title;
      document.getElementById("updateTags").value = storedData[index].tag;
      document.getElementById("updateContent").value =
        storedData[index].content;

      // Display the update form and overlay
      updateForm.style.display = "block";
      overlay.style.display = "block";

      // Store the index of the post being updated in a data attribute
      updateForm.setAttribute("data-index", index);
    }

    function updatePost() {
      const storedData = JSON.parse(localStorage.getItem("postData")) || [];
      const updateForm = document.getElementById("updateForm");
      const overlay = document.getElementById("overlay");

      // Retrieve the index of the post being updated
      const index = parseInt(updateForm.getAttribute("data-index"));

      // Update the post data with the values from the form
      storedData[index].title = document.getElementById("updateTitle").value;
      storedData[index].tag = document.getElementById("updateTags").value;
      storedData[index].content =
        document.getElementById("updateContent").value;

      // Save the updated data back to local storage
      localStorage.setItem("postData", JSON.stringify(storedData));

      // Close the update form and overlay
      updateForm.style.display = "none";
      overlay.style.display = "none";

      // Refresh the display
      location.reload();
    }

    function closeUpdateForm() {
      const updateForm = document.getElementById("updateForm");
      const overlay = document.getElementById("overlay");

      // Close the update form and overlay
      updateForm.style.display = "none";
      overlay.style.display = "none";
    }

    // Call the function to retrieve and display the data
    retrieveDataFromLocalStorage();
  </script>
</html>
